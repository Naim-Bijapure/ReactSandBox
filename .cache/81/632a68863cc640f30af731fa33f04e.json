{"id":"../node_modules/aws-amplify-react/dist/Auth/Authenticator.js","dependencies":[{"name":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js.map","includedInParent":true,"mtime":1552220008284},{"name":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/src/Auth/Authenticator.jsx","includedInParent":true,"mtime":1552220008284},{"name":"/home/pronoob/Desktop/SandBox/ReactSandBox/package.json","includedInParent":true,"mtime":1552220018357},{"name":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/package.json","includedInParent":true,"mtime":1552220008284},{"name":"react","loc":{"line":26,"column":22},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/react/index.js"},{"name":"@aws-amplify/core","loc":{"line":27,"column":21},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/@aws-amplify/core/lib/index.js"},{"name":"@aws-amplify/auth","loc":{"line":28,"column":21},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/@aws-amplify/auth/lib/index.js"},{"name":"./Greetings","loc":{"line":29,"column":26},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Greetings.js"},{"name":"./SignIn","loc":{"line":30,"column":23},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/SignIn.js"},{"name":"./ConfirmSignIn","loc":{"line":31,"column":30},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/ConfirmSignIn.js"},{"name":"./RequireNewPassword","loc":{"line":32,"column":35},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/RequireNewPassword.js"},{"name":"./SignUp","loc":{"line":33,"column":23},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/SignUp.js"},{"name":"./Loading","loc":{"line":34,"column":24},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Loading.js"},{"name":"./ConfirmSignUp","loc":{"line":35,"column":30},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/ConfirmSignUp.js"},{"name":"./VerifyContact","loc":{"line":36,"column":30},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/VerifyContact.js"},{"name":"./ForgotPassword","loc":{"line":37,"column":31},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/ForgotPassword.js"},{"name":"./TOTPSetup","loc":{"line":38,"column":26},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/TOTPSetup.js"},{"name":"./common/constants","loc":{"line":39,"column":26},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/common/constants.js"},{"name":"../Amplify-UI/Amplify-UI-Theme","loc":{"line":40,"column":33},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Amplify-UI/Amplify-UI-Theme.js"},{"name":"../AmplifyMessageMap","loc":{"line":41,"column":34},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/AmplifyMessageMap.js"},{"name":"../Amplify-UI/Amplify-UI-Components-React","loc":{"line":42,"column":44},"parent":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Auth/Authenticator.js","resolved":"/home/pronoob/Desktop/SandBox/ReactSandBox/node_modules/aws-amplify-react/dist/Amplify-UI/Amplify-UI-Components-React.js"}],"generated":{"js":"\"use strict\";\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar react_1 = require(\"react\");\nvar core_1 = require(\"@aws-amplify/core\");\nvar auth_1 = require(\"@aws-amplify/auth\");\nvar Greetings_1 = require(\"./Greetings\");\nvar SignIn_1 = require(\"./SignIn\");\nvar ConfirmSignIn_1 = require(\"./ConfirmSignIn\");\nvar RequireNewPassword_1 = require(\"./RequireNewPassword\");\nvar SignUp_1 = require(\"./SignUp\");\nvar Loading_1 = require(\"./Loading\");\nvar ConfirmSignUp_1 = require(\"./ConfirmSignUp\");\nvar VerifyContact_1 = require(\"./VerifyContact\");\nvar ForgotPassword_1 = require(\"./ForgotPassword\");\nvar TOTPSetup_1 = require(\"./TOTPSetup\");\nvar constants_1 = require(\"./common/constants\");\nvar Amplify_UI_Theme_1 = require(\"../Amplify-UI/Amplify-UI-Theme\");\nvar AmplifyMessageMap_1 = require(\"../AmplifyMessageMap\");\nvar Amplify_UI_Components_React_1 = require(\"../Amplify-UI/Amplify-UI-Components-React\");\nvar logger = new core_1.ConsoleLogger('Authenticator');\nvar AUTHENTICATOR_AUTHSTATE = 'amplify-authenticator-authState';\nvar Authenticator = /** @class */ (function (_super) {\n    __extends(Authenticator, _super);\n    function Authenticator(props) {\n        var _this = _super.call(this, props) || this;\n        _this.handleStateChange = _this.handleStateChange.bind(_this);\n        _this.handleAuthEvent = _this.handleAuthEvent.bind(_this);\n        _this.onHubCapsule = _this.onHubCapsule.bind(_this);\n        _this._initialAuthState = _this.props.authState || 'signIn';\n        _this.state = { authState: 'loading' };\n        core_1.Hub.listen('auth', _this);\n        return _this;\n    }\n    Authenticator.prototype.componentDidMount = function () {\n        var config = this.props.amplifyConfig;\n        if (config) {\n            core_1.default.configure(config);\n        }\n        this._isMounted = true;\n        // the workaround for Cognito Hosted UI\n        // don't check the user immediately if redirected back from Hosted UI\n        // instead waiting for the hub event sent from Auth module\n        // the item in the localStorage is a mark to indicate whether\n        // the app is redirected back from Hosted UI or not\n        var byHostedUI = localStorage.getItem(constants_1.default.SIGN_IN_WITH_HOSTEDUI_KEY);\n        localStorage.removeItem(constants_1.default.SIGN_IN_WITH_HOSTEDUI_KEY);\n        if (!byHostedUI)\n            this.checkUser();\n    };\n    Authenticator.prototype.componentWillUnmount = function () {\n        this._isMounted = false;\n    };\n    Authenticator.prototype.checkUser = function () {\n        var _this = this;\n        if (!auth_1.default || typeof auth_1.default.currentAuthenticatedUser !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n        }\n        return auth_1.default.currentAuthenticatedUser()\n            .then(function (user) {\n            if (!_this._isMounted) {\n                return;\n            }\n            _this.handleStateChange('signedIn', user);\n        })\n            .catch(function (err) {\n            if (!_this._isMounted) {\n                return;\n            }\n            var cachedAuthState = null;\n            try {\n                cachedAuthState = localStorage.getItem(AUTHENTICATOR_AUTHSTATE);\n            }\n            catch (e) {\n                logger.debug('Failed to get the auth state from local storage', e);\n            }\n            var promise = cachedAuthState === 'signedIn' ? auth_1.default.signOut() : Promise.resolve();\n            promise.then(function () { return _this.handleStateChange(_this._initialAuthState); })\n                .catch(function (e) {\n                logger.debug('Failed to sign out', e);\n            });\n        });\n    };\n    Authenticator.prototype.onHubCapsule = function (capsule) {\n        var channel = capsule.channel, payload = capsule.payload, source = capsule.source;\n        if (channel === 'auth') {\n            switch (payload.event) {\n                case 'cognitoHostedUI':\n                    this.handleStateChange('signedIn', payload.data);\n                    break;\n                case 'cognitoHostedUI_failure':\n                    this.handleStateChange('signIn', null);\n                    break;\n                case 'parsingUrl_failure':\n                    this.handleStateChange('signIn', null);\n                    break;\n                case 'signOut':\n                    this.handleStateChange('signIn', null);\n                    break;\n                case 'customGreetingSignOut':\n                    this.handleStateChange('signIn', null);\n                    break;\n                default:\n                    break;\n            }\n        }\n    };\n    Authenticator.prototype.handleStateChange = function (state, data) {\n        logger.debug('authenticator state change ' + state, data);\n        if (state === this.state.authState) {\n            return;\n        }\n        if (state === 'signedOut') {\n            state = 'signIn';\n        }\n        try {\n            localStorage.setItem(AUTHENTICATOR_AUTHSTATE, state);\n        }\n        catch (e) {\n            logger.debug('Failed to set the auth state into local storage', e);\n        }\n        if (this._isMounted) {\n            this.setState({ authState: state, authData: data, error: null, showToast: false });\n        }\n        if (this.props.onStateChange) {\n            this.props.onStateChange(state, data);\n        }\n    };\n    Authenticator.prototype.handleAuthEvent = function (state, event, showToast) {\n        if (showToast === void 0) { showToast = true; }\n        if (event.type === 'error') {\n            var map = this.props.errorMessage || AmplifyMessageMap_1.default;\n            var message = (typeof map === 'string') ? map : map(event.data);\n            this.setState({ error: message, showToast: showToast });\n        }\n    };\n    Authenticator.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, authState = _a.authState, authData = _a.authData;\n        var theme = this.props.theme || Amplify_UI_Theme_1.default;\n        var messageMap = this.props.errorMessage || AmplifyMessageMap_1.default;\n        var _b = this.props, hideDefault = _b.hideDefault, _c = _b.hide, hide = _c === void 0 ? [] : _c, federated = _b.federated, signUpConfig = _b.signUpConfig;\n        if (hideDefault) {\n            hide = hide.concat([\n                Greetings_1.default,\n                SignIn_1.default,\n                ConfirmSignIn_1.default,\n                RequireNewPassword_1.default,\n                SignUp_1.default,\n                ConfirmSignUp_1.default,\n                VerifyContact_1.default,\n                ForgotPassword_1.default,\n                TOTPSetup_1.default,\n                Loading_1.default\n            ]);\n        }\n        var props_children = [];\n        if (typeof this.props.children === 'object') {\n            if (Array.isArray(this.props.children)) {\n                props_children = this.props.children;\n            }\n            else {\n                props_children.push(this.props.children);\n            }\n        }\n        var default_children = [\n            React.createElement(Greetings_1.default, { federated: federated }),\n            React.createElement(SignIn_1.default, { federated: federated }),\n            React.createElement(ConfirmSignIn_1.default, null),\n            React.createElement(RequireNewPassword_1.default, null),\n            React.createElement(SignUp_1.default, { signUpConfig: signUpConfig }),\n            React.createElement(ConfirmSignUp_1.default, null),\n            React.createElement(VerifyContact_1.default, null),\n            React.createElement(ForgotPassword_1.default, null),\n            React.createElement(TOTPSetup_1.default, null),\n            React.createElement(Loading_1.default, null)\n        ];\n        var props_children_override = React.Children.map(props_children, function (child) { return child.props.override; });\n        hide = hide.filter(function (component) { return !props_children.find(function (child) { return child.type === component; }); });\n        var render_props_children = React.Children.map(props_children, function (child, index) {\n            return React.cloneElement(child, {\n                key: 'aws-amplify-authenticator-props-children-' + index,\n                theme: theme,\n                messageMap: messageMap,\n                authState: authState,\n                authData: authData,\n                onStateChange: _this.handleStateChange,\n                onAuthEvent: _this.handleAuthEvent,\n                hide: hide,\n                override: props_children_override\n            });\n        });\n        var render_default_children = hideDefault ? [] : React.Children.map(default_children, function (child, index) {\n            return React.cloneElement(child, {\n                key: 'aws-amplify-authenticator-default-children-' + index,\n                theme: theme,\n                messageMap: messageMap,\n                authState: authState,\n                authData: authData,\n                onStateChange: _this.handleStateChange,\n                onAuthEvent: _this.handleAuthEvent,\n                hide: hide,\n                override: props_children_override\n            });\n        });\n        var render_children = render_default_children.concat(render_props_children);\n        var error = this.state.error;\n        return (React.createElement(Amplify_UI_Components_React_1.Container, { theme: theme },\n            this.state.showToast &&\n                React.createElement(Amplify_UI_Components_React_1.Toast, { theme: theme, onClose: function () { return _this.setState({ showToast: false }); } }, core_1.I18n.get(error)),\n            render_children));\n    };\n    return Authenticator;\n}(react_1.Component));\nexports.default = Authenticator;\n"},"sourceMaps":{"js":{"version":3,"file":"Authenticator.js","sourceRoot":"","sources":["../../src/Auth/Authenticator.jsx"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { Component } from 'react';\nimport Amplify, { I18n, ConsoleLogger as Logger, Hub } from '@aws-amplify/core';\nimport Auth from '@aws-amplify/auth';\nimport Greetings from './Greetings';\nimport SignIn from './SignIn';\nimport ConfirmSignIn from './ConfirmSignIn';\nimport RequireNewPassword from './RequireNewPassword';\nimport SignUp from './SignUp';\nimport Loading from './Loading';\nimport ConfirmSignUp from './ConfirmSignUp';\nimport VerifyContact from './VerifyContact';\nimport ForgotPassword from './ForgotPassword';\nimport TOTPSetup from './TOTPSetup';\nimport Constants from './common/constants';\n\nimport AmplifyTheme from '../Amplify-UI/Amplify-UI-Theme';\nimport AmplifyMessageMap from '../AmplifyMessageMap';\n\nimport { Container, Toast } from '../Amplify-UI/Amplify-UI-Components-React';\n\nconst logger = new Logger('Authenticator');\nconst AUTHENTICATOR_AUTHSTATE = 'amplify-authenticator-authState';\n\nexport default class Authenticator extends Component {\n    constructor(props) {\n        super(props);\n\n        this.handleStateChange = this.handleStateChange.bind(this);\n        this.handleAuthEvent = this.handleAuthEvent.bind(this);\n        this.onHubCapsule = this.onHubCapsule.bind(this);\n\n        this._initialAuthState = this.props.authState || 'signIn';\n        this.state = { authState: 'loading' };\n        Hub.listen('auth', this);\n    }\n\n    componentDidMount() {\n        const config = this.props.amplifyConfig;\n        if (config) {\n            Amplify.configure(config);\n        }\n        this._isMounted = true;\n        // the workaround for Cognito Hosted UI\n        // don't check the user immediately if redirected back from Hosted UI\n        // instead waiting for the hub event sent from Auth module\n        // the item in the localStorage is a mark to indicate whether\n        // the app is redirected back from Hosted UI or not\n        const byHostedUI = localStorage.getItem(Constants.SIGN_IN_WITH_HOSTEDUI_KEY);\n        localStorage.removeItem(Constants.SIGN_IN_WITH_HOSTEDUI_KEY);\n        if (!byHostedUI) this.checkUser();\n    }\n\n    componentWillUnmount() {\n        this._isMounted = false;\n    }\n    checkUser() {\n        if (!Auth || typeof Auth.currentAuthenticatedUser !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n        }\n        return Auth.currentAuthenticatedUser()\n            .then(user => {\n                if (!this._isMounted) { return; }\n                this.handleStateChange('signedIn', user);\n            })\n            .catch(err => {\n                if (!this._isMounted) { return; }\n                let cachedAuthState = null;\n                try {\n                    cachedAuthState = localStorage.getItem(AUTHENTICATOR_AUTHSTATE);\n                } catch (e) {\n                    logger.debug('Failed to get the auth state from local storage', e);\n                }\n                const promise = cachedAuthState === 'signedIn'? Auth.signOut() : Promise.resolve();\n                promise.then(() => this.handleStateChange(this._initialAuthState))\n                    .catch((e) => {\n                        logger.debug('Failed to sign out', e);\n                    });\n            });\n    }\n\n    onHubCapsule(capsule) {\n        const { channel, payload, source } = capsule;\n        if (channel === 'auth') {\n            switch (payload.event) {\n                case 'cognitoHostedUI':\n                    this.handleStateChange('signedIn', payload.data);\n                    break;\n                case 'cognitoHostedUI_failure':\n                    this.handleStateChange('signIn', null);\n                    break;\n                case 'parsingUrl_failure':\n                    this.handleStateChange('signIn', null);\n                    break;\n                case 'signOut':\n                    this.handleStateChange('signIn', null);\n                    break;\n                case 'customGreetingSignOut':\n                    this.handleStateChange('signIn', null);\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n\n    handleStateChange(state, data) {\n        logger.debug('authenticator state change ' + state, data);\n        if (state === this.state.authState) { return; }\n\n        if (state === 'signedOut') { state = 'signIn'; }\n        try {\n            localStorage.setItem(AUTHENTICATOR_AUTHSTATE, state);\n        } catch (e) {\n            logger.debug('Failed to set the auth state into local storage', e);\n        }\n\n        if (this._isMounted) {\n            this.setState({ authState: state, authData: data, error: null, showToast: false });            \n        }\n        if (this.props.onStateChange) { this.props.onStateChange(state, data); }\n    }\n\n    handleAuthEvent(state, event, showToast = true) {\n        if (event.type === 'error') {\n            const map = this.props.errorMessage || AmplifyMessageMap;\n            const message = (typeof map === 'string')? map : map(event.data);\n            this.setState({ error: message, showToast });\n            \n        }\n    }\n\n    render() {\n        const { authState, authData } = this.state;\n        const theme = this.props.theme || AmplifyTheme;\n        const messageMap = this.props.errorMessage || AmplifyMessageMap;\n\n        let { hideDefault, hide = [], federated, signUpConfig } = this.props;\n        if (hideDefault) {\n            hide = hide.concat([\n                Greetings,\n                SignIn,\n                ConfirmSignIn,\n                RequireNewPassword,\n                SignUp,\n                ConfirmSignUp,\n                VerifyContact,\n                ForgotPassword,\n                TOTPSetup,\n                Loading\n            ]);\n        }\n\n        let props_children = [];\n        if (typeof this.props.children === 'object') {\n            if (Array.isArray(this.props.children)){\n                props_children = this.props.children;\n            } else {\n                props_children.push(this.props.children);\n            }\n        } \n\n        const default_children = [\n            <Greetings federated={federated}/>,\n            <SignIn federated={federated}/>,\n            <ConfirmSignIn/>,\n            <RequireNewPassword/>,\n            <SignUp signUpConfig={signUpConfig}/>,\n            <ConfirmSignUp/>,\n            <VerifyContact/>,\n            <ForgotPassword/>,\n            <TOTPSetup/>,\n            <Loading/>\n        ];\n\n        const props_children_override =  React.Children.map(props_children, child => child.props.override);\n        hide = hide.filter((component) => !props_children.find(child => child.type === component));\n        \n        const render_props_children = React.Children.map(props_children, (child, index) => {\n            return React.cloneElement(child, {\n                    key: 'aws-amplify-authenticator-props-children-' + index,\n                    theme,\n                    messageMap,\n                    authState,\n                    authData,\n                    onStateChange: this.handleStateChange,\n                    onAuthEvent: this.handleAuthEvent,\n                    hide,\n                    override: props_children_override\n                });\n        });\n       \n        const render_default_children = hideDefault ? [] : React.Children.map(default_children, (child, index) => {\n                return React.cloneElement(child, {\n                    key: 'aws-amplify-authenticator-default-children-' + index,\n                    theme,\n                    messageMap,\n                    authState,\n                    authData,\n                    onStateChange: this.handleStateChange,\n                    onAuthEvent: this.handleAuthEvent,\n                    hide,\n                    override: props_children_override\n                });\n            });\n\n        const render_children = render_default_children.concat(render_props_children);\n        const error = this.state.error;        \n\n        return (\n            <Container theme={theme}>\n                {this.state.showToast && \n                    <Toast theme={theme} onClose={() => this.setState({showToast: false})}>\n                        { I18n.get(error) }\n                    </Toast>\n                }\n                {render_children}\n            </Container>\n        );\n    }\n}\n"]}},"error":null,"hash":"246e531168d4d9e0e3ac45a053187519","cacheData":{"env":{}}}